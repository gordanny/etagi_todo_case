(this["webpackJsonpetagi-todo"]=this["webpackJsonpetagi-todo"]||[]).push([[0],{14:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),r=n(9),i=n.n(r),o=(n(14),n(2)),c=n(3),l=n(5),u=n(4),h=n(6),d=n(7),j=n(0),b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).handleFormattedDate=function(){var e=new Date;return[String(e.getFullYear()),String(e.getMonth()+1).padStart(2,0),String(e.getDate()).padStart(2,0)].join("-")},s.handleInputChange=function(e){var t=e.target.name,n=e.target.value;s.setState((function(e){var s=Object(d.a)({},e);return"responsibleSelect"===t?s[t]=n:s.form[t]=n,s}))},s.handleResponsibleAdd=function(e){e.preventDefault();var t,n=e.target.value,a=s.state.responsibleList.slice(),r=Object(h.a)(a);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id&&i.id===+n){i.view=!1,s.state.form.responsible.push(n);break}s.setState({responsibleList:a})}}catch(o){r.e(o)}finally{r.f()}},s.handleResponsibleSelect=function(){var e=s.state.responsibleList.map((function(e){var t;return e.view?(t=s.props.userList[e.id]?s.props.userList[e.id].fullName:e.username,Object(j.jsx)("option",{value:e.id,children:t},e.id)):null}));return Object(j.jsxs)("div",{children:[Object(j.jsx)("select",{name:"responsibleSelect",value:s.state.responsibleSelect,onChange:s.handleInputChange,children:e}),Object(j.jsx)("button",{value:s.state.responsibleSelect,onClick:s.handleResponsibleAdd,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),Object(j.jsx)("br",{})]})},s.state={form:{title:"",description:"",expiration_date:s.handleFormattedDate(),priority:"LW",status:"TW",creator:s.props.userID,responsible:[]},responsibleList:[{id:0,username:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c",view:!0},{id:s.props.userID,username:s.props.username,view:!0}].concat(s.props.responsibleList),responsibleSelect:0},s}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.handleResponsibleSelect();return Object(j.jsxs)("form",{onSubmit:function(t){return e.props.handleCreateTask(t,e.state.form)},children:[Object(j.jsx)("h4",{children:"\u041d\u043e\u0432\u0430\u044f \u0437\u0430\u0434\u0430\u0447\u0430"}),Object(j.jsx)("label",{htmlFor:"title",children:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a"}),Object(j.jsx)("input",{type:"text",name:"title",value:this.state.form.title,onChange:this.handleInputChange}),Object(j.jsx)("label",{htmlFor:"description",children:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}),Object(j.jsx)("input",{type:"text",name:"description",value:this.state.form.description,onChange:this.handleInputChange}),Object(j.jsx)("label",{htmlFor:"expiration_date",children:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f"}),Object(j.jsx)("input",{type:"text",name:"expiration_date",value:this.state.form.expiration_date,onChange:this.handleInputChange}),Object(j.jsx)("label",{htmlFor:"priority",children:"\u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442"}),Object(j.jsx)("br",{}),Object(j.jsxs)("select",{name:"priority",value:this.state.form.priority,onChange:this.handleInputChange,children:[Object(j.jsx)("option",{value:"LW",children:"\u041d\u0438\u0437\u043a\u0438\u0439"}),Object(j.jsx)("option",{value:"MD",children:"\u0421\u0440\u0435\u0434\u043d\u0438\u0439"}),Object(j.jsx)("option",{value:"HI",children:"\u0412\u044b\u0441\u043e\u043a\u0438\u0439"})]}),Object(j.jsx)("br",{}),Object(j.jsx)("label",{htmlFor:"responsible",children:"\u041e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435"}),Object(j.jsx)("br",{}),t,Object(j.jsx)("input",{type:"submit"})]})}}]),n}(a.a.Component),p=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var s,a=this;return Object(o.a)(this,n),(s=t.call(this,e)).handleShowForm=function(){return Object(j.jsx)(b,{username:s.state.username,userID:s.state.userID,handleCreateTask:s.handleCreateTask,responsibleList:s.state.responsibleList,userList:s.props.userList})},s.handleCreateTask=function(e,t){e.preventDefault(),fetch("API/tasks/create/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("token"))},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){return console.log(e)}))},s.handleFormattedDate=function(){var e=new Date;return[String(e.getFullYear()),String(e.getMonth()+1).padStart(2,0),String(e.getDate()).padStart(2,0)].join("-")},s.handleResposible=function(e){var t,n=[];return e.list.forEach((function(e){t=s.props.userList[e]?s.props.userList[e].fullName:e,n.push(Object(j.jsxs)("span",{children:[t," "]},e))})),Object(j.jsx)("div",{children:n})},s.handleCreateTasksList=function(e){var t=e.map((function(e){return Object(j.jsxs)("div",{id:e.id,children:[Object(j.jsx)("div",{children:e.title}),Object(j.jsx)("div",{children:s.priorityDict[e.priority]}),Object(j.jsx)("div",{children:e.expiration_date}),Object(j.jsx)(a.handleResposible,{list:e.responsible}),Object(j.jsx)("div",{children:s.statusDict[e.status]}),Object(j.jsx)("br",{})]},e.id)}));return Object(j.jsx)("div",{children:t})},s.handleShowMyTasks=function(){var e=s.handleFormattedDate(),t=new Date;t.setDate(t.getDate()+7);var n=[],a=[],r=[];s.state.tasksList.forEach((function(i){var o=new Date(i.expiration_date);i.responsible.includes(s.state.userID)&&(i.expiration_date===e?n.push(i):o<=t?a.push(i):r.push(i))}));var i=s.handleCreateTasksList(n),o=s.handleCreateTasksList(a),c=s.handleCreateTasksList(r);return Object(j.jsxs)("div",{children:[Object(j.jsx)("span",{children:"TODAY"}),i,Object(j.jsx)("br",{}),Object(j.jsx)("span",{children:"WEEK"}),o,Object(j.jsx)("br",{}),Object(j.jsx)("span",{children:"OTHER"}),c,Object(j.jsx)("br",{})]})},s.handleShowMyTeamTasks=function(){var e,t=[];return s.state.responsibleList.length?(s.state.tasksList.forEach((function(e){var n,a=Object(h.a)(s.state.responsibleList);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e.responsible.includes(r.id)){t.push(e);break}}}catch(i){a.e(i)}finally{a.f()}})),e=t.length?s.handleCreateTasksList(t):Object(j.jsx)("span",{children:"\u0423 \u0432\u0430\u0448\u0438\u0445 \u043f\u043e\u0434\u0447\u0438\u043d\u0435\u043d\u043d\u044b\u0445 \u043d\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0445 \u0437\u0430\u0434\u0430\u0447."})):e=Object(j.jsx)("span",{children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u043f\u043e\u0434\u0447\u0438\u043d\u0435\u043d\u043d\u044b\u0445."}),Object(j.jsx)("div",{children:e})},s.handleShowTasksByResponsible=function(){var e={};s.state.tasksList.forEach((function(t){t.responsible.forEach((function(n){n in e||(e[n]=[]),e[n].push(t)}))}));var t=[];for(var n in e){var a=s.handleCreateTasksList(e[n]);t.push(Object(j.jsxs)("div",{id:n,children:[Object(j.jsxs)("p",{children:["\u0417\u0430\u0434\u0430\u0447\u0438 - ",n]}),Object(j.jsx)("div",{children:a})]},n))}return Object(j.jsx)("div",{children:t})},s.handleShowAllTasks=function(){var e=s.handleCreateTasksList(s.state.tasksList);return Object(j.jsx)("div",{children:e})},s.state={tasksList:[],view:s.props.view,username:s.props.username,userID:s.props.userID,responsibleList:[],refresh:!1},s.statusDict={TW:"\u041a \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044e",IP:"\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f",FD:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430",CL:"\u041e\u0442\u043c\u0435\u043d\u0435\u043d\u0430"},s.priorityDict={LW:"\u041d\u0438\u0437\u043a\u0438\u0439",MD:"\u0421\u0440\u0435\u0434\u043d\u0438\u0439",HI:"\u0412\u044b\u0441\u043e\u043a\u0438\u0439"},s}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("pewpew"),fetch("API/tasks/get/",{headers:{Authorization:"JWT ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){console.log(t),e.setState({tasksList:t})})),fetch("API/users/responsible/",{headers:{Authorization:"JWT ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){if(t.length){var n=t.map((function(e){return{id:e.id,username:e.username,view:!0}}));e.setState({responsibleList:n})}}))}},{key:"render",value:function(){var e;switch(this.props.view){case"my":e=this.handleShowMyTasks();break;case"myTeam":e=this.handleShowMyTeamTasks();break;case"all":e=this.handleShowAllTasks();break;case"allByResponsible":e=this.handleShowTasksByResponsible();break;case"createForm":e=this.handleShowForm();break;default:e=null}return Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"Tasks"}),Object(j.jsx)("br",{}),Object(j.jsx)("div",{children:e})]})}}]),n}(a.a.Component),f=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).handleLogout=function(){localStorage.removeItem("token"),s.props.onLoggedInChange(!1)},s.handleUserCheck=function(){return s.state.username&&s.state.userID},s.handleViewChange=function(e){e.preventDefault(),s.setState({view:e.target.value})},s.state={username:"",userID:"",view:"all",createTask:!1},s.userList={},s}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;fetch("API/users/current/",{headers:{Authorization:"JWT ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){e.setState({username:t.username}),e.setState({userID:t.id})})),fetch("API/users/get_all/",{headers:{Authorization:"JWT ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){t.length&&t.forEach((function(t){e.userList[t.id]={},Object.assign(e.userList[t.id],t),delete e.userList[t.id].id;var n=t.first_name?t.first_name.slice(0,1).toUpperCase()+".":"",s=t.patronymic?t.patronymic.slice(0,1).toUpperCase()+".":"",a=n?" "+n+s:"",r=t.last_name+a;e.userList[t.id].fullName=r||t.username}))}))}},{key:"render",value:function(){var e,t,n=this;return this.handleUserCheck()?(e=Object(j.jsx)("button",{value:"createForm",onClick:function(e){return n.handleViewChange(e)},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}),t=Object(j.jsx)(p,{username:this.state.username,userID:this.state.userID,view:this.state.view,userList:this.userList})):(e=!1,t=!1),Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{children:[Object(j.jsx)("span",{children:this.state.username}),Object(j.jsx)("button",{onClick:this.handleLogout,children:"logout"}),Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{value:"my",onClick:function(e){return n.handleViewChange(e)},children:"\u041c\u043e\u0438 \u0437\u0430\u0434\u0430\u0447\u0438"}),Object(j.jsx)("button",{value:"myTeam",onClick:function(e){return n.handleViewChange(e)},children:"\u0417\u0430\u0434\u0430\u0447\u0438 \u043c\u043e\u0435\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b"}),Object(j.jsx)("button",{value:"all",onClick:function(e){return n.handleViewChange(e)},children:"\u0412\u0441\u0435 \u0437\u0430\u0434\u0430\u0447\u0438"}),Object(j.jsx)("button",{value:"allByResponsible",onClick:function(e){return n.handleViewChange(e)},children:"\u0417\u0430\u0434\u0430\u0447\u0438 \u043f\u043e \u043e\u0442\u0432\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c"}),e]})]}),Object(j.jsx)("br",{}),t]})}}]),n}(a.a.Component),v=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).handleInputChange=function(e){var t=e.target.name,n=e.target.value;s.setState((function(e){var s=Object(d.a)({},e);return s[t]=n,s}))},s.state={username:"",password:""},s}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("form",{onSubmit:function(t){return e.props.handleLogin(t,e.state)},children:[Object(j.jsx)("h4",{children:"Log In"}),Object(j.jsx)("label",{htmlFor:"username",children:"Username"}),Object(j.jsx)("input",{type:"text",name:"username",value:this.state.username,onChange:this.handleInputChange}),Object(j.jsx)("label",{htmlFor:"password",children:"Password"}),Object(j.jsx)("input",{type:"password",name:"password",value:this.state.password,onChange:this.handleInputChange}),Object(j.jsx)("input",{type:"submit"})]})}}]),n}(a.a.Component),O=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).verifyAuthenticationJSON=function(e){e.token?(localStorage.setItem("token",e.token),s.props.onLoggedInChange(!0)):s.setState({loginError:e.non_field_errors})},s.handleLogin=function(e,t){if(e.preventDefault(),t.username&&t.password)fetch("/token-auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){return s.verifyAuthenticationJSON(e)}));else{var n=t.username?"empty_password":"empty_username";s.setState({loginError:n})}},s.state={loginError:null},s}return Object(c.a)(n,[{key:"render",value:function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)("span",{children:{invalid_username:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0441 \u0442\u0430\u043a\u0438\u043c \u043b\u043e\u0433\u0438\u043d\u043e\u043c \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442",invalid_password:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c",empty_username:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c",empty_password:"\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c"}[this.state.loginError]}),Object(j.jsx)(v,{handleLogin:this.handleLogin})]})}}]),n}(a.a.Component),g=(n(16),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).handleLoggedInChange=function(e){s.setState({isLoggedIn:e})},s.state={isLoggedIn:!!localStorage.getItem("token")},s}return Object(c.a)(n,[{key:"render",value:function(){return this.state.isLoggedIn?Object(j.jsx)(f,{onLoggedInChange:this.handleLoggedInChange}):Object(j.jsx)(O,{onLoggedInChange:this.handleLoggedInChange})}}]),n}(a.a.Component)),m=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),r(e),i(e)}))};i.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(g,{})}),document.getElementById("root")),m()}},[[17,1,2]]]);
//# sourceMappingURL=main.2fc2d5cc.chunk.js.map